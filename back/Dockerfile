FROM node:buster-slim
WORKDIR /api

RUN apt-get update && \ 
	apt-get install -y build-essential \
	wget \
	python3 \
	make \
	gcc \ 
	libc6-dev

COPY package*.json /api/
RUN npm i

COPY . /api/

ENV AWS_ACCESS_ID=${AWS_ACCESS_ID}
ENV AWS_ACCESS_SECRET=${AWS_ACCESS_SECRET}
ENV AWS_BUCKET_NAME=${AWS_BUCKET_NAME}
ENV MONGO_URI=${MONGO_URI}
ENV MONGO_DB_NAME=${MONGO_DB_NAME}
ENV MONGO_COLLECTION=${MONGO_COLLECTION}
ENV KANJI_ALIVE_API_DOMAIN=${KANJI_ALIVE_API_DOMAIN}
ENV KANJI_ALIVE_API_KEY=${KANJI_ALIVE_API_KEY}
ENV PORT=${PORT}

EXPOSE ${PORT}
CMD ["npm", "run", "build"]

FROM node:buster-slim
WORKDIR /api

COPY . /api/
RUN npm install

ARG AWS_ACCESS_ID
ENV AWS_ACCESS_ID ${AWS_ACCESS_ID}
ARG AWS_ACCESS_SECRET
ENV AWS_ACCESS_SECRET=${AWS_ACCESS_SECRET}
ARG AWS_BUCKET_NAME
ENV AWS_BUCKET_NAME=${AWS_BUCKET_NAME}
ARG MONGO_URI
ENV MONGO_URI=${MONGO_URI}
ARG MONGO_DB_NAME
ENV MONGO_DB_NAME=${MONGO_DB_NAME}
ARG MONGO_COLLECTION
ENV MONGO_COLLECTION=${MONGO_COLLECTION}
ARG KANJI_RECOGNIZER_KEY
ENV KANJI_RECOGNIZER_KEY=${KANJI_RECOGNIZER_KEY}
ARG AUTH_API_SECRET_KEY
ENV AUTH_API_SECRET_KEY=${AUTH_API_SECRET_KEY}
ARG AUTH_API_SECRET_WEB
ENV AUTH_API_SECRET_WEB=${AUTH_API_SECRET_WEB}
ARG AUTH_API_SECRET_NATIVE
ENV AUTH_API_SECRET_NATIVE=${AUTH_API_SECRET_NATIVE}
ARG PORT
ENV PORT=${PORT}

RUN npm run build

EXPOSE 8080

CMD node dist/app.js
